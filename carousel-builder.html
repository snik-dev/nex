<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MNE.com Carousel Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{navy:'#002366',gold:'#ffc72c'}}}}</script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <style>
    .badge{position:absolute;top:6px;left:6px;background:#ffc72c;color:#002366;font-weight:700;font-size:.75rem;padding:2px 6px;border-radius:9999px}
    .placeholder{background:#e2e8f0;display:flex;align-items:center;justify-content:center;height:200px;font-size:.875rem;color:#6b7280}
    .promo-badge{position:absolute;top:6px;right:6px;background:#002366;color:#fff;font-size:.625rem;font-weight:700;padding:2px 6px;border-radius:4px}
    .star{color:#ffc72c;font-size:.75rem;margin-right:1px}
    #previewArea::-webkit-scrollbar{height:8px}#previewArea::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}
  </style>
</head>
<body class="bg-gray-100 p-6 min-h-screen flex flex-col gap-6">
  <header class="bg-navy text-white p-4 rounded shadow mb-6"><h1 class="text-3xl font-semibold">MNE.com Carousel Generator</h1></header>

  <div class="grid lg:grid-cols-3 gap-6 w-full">
    <div class="lg:col-span-1 space-y-6">
      <form id="builder" class="space-y-4">
        <div><label class="font-medium block mb-1">Carousel Title</label><input id="carouselTitle" class="border rounded p-2 w-full"/></div>
        <div class="flex items-center gap-2"><input id="showReviews" type="checkbox" class="h-4 w-4" checked><label>Include review count</label></div>
        <div><label class="font-medium block mb-1">Template Type</label><select id="templateSelect" class="border rounded p-2 w-full"><option value="standard">Standard – Brand, Name, MSRP, Price</option><option value="promo">Promo – Name, Price, Badge</option><option value="minimal">Minimal – Image & Name</option></select></div>
        <div id="itemsContainer" class="space-y-6"></div>
        <button id="addItem" type="button" class="bg-gold text-navy w-full py-2 rounded shadow">Add Item (0/10)</button>
        <hr class="my-4"/>
        <h2 class="font-semibold text-lg mb-2">Bulk CSV Upload</h2>
        <input id="csvFile" type="file" accept=".csv" class="mb-2">
        <br><a href="https://snik-dev.github.io/nex/template.csv" target="_blank" class="text-sm text-navy underline">Download CSV template</a>
      </form>
    </div>

    <div class="lg:col-span-2">
      <h2 class="text-xl font-semibold mb-2">Live Preview <span class="text-sm text-gray-600">(drag to reorder)</span></h2>
      <div id="previewTitle" class="font-semibold text-lg mb-4"></div>
      <div id="previewArea" class="flex flex-nowrap gap-4 overflow-x-auto pb-4"></div>
      <div id="a11yReport" class="text-danger text-sm mt-4"></div>
    </div>
  </div>

  <div class="grid lg:grid-cols-2 gap-6 mt-8">
    <div><h2 class="text-xl font-semibold mb-2">Generated HTML</h2><textarea id="output" class="w-full h-64 border p-2 font-mono text-xs"></textarea><button id="copyCode" class="mt-2 px-4 py-2 bg-navy text-white rounded shadow">Copy</button></div>
    <div><h2 class="text-xl font-semibold mb-2">HTML Input (Import)</h2><textarea id="importHtml" class="w-full h-64 border p-2 font-mono text-xs"></textarea><button id="importBtn" class="mt-2 px-4 py-2 bg-navy text-white rounded shadow">Import</button></div>
  </div>

  <template id="itemTemplate">
    <div data-item class="border p-4 rounded shadow bg-white space-y-3">
      <div class="flex justify-between items-center"><span class="itemIndex font-bold">#</span><button type="button" class="removeItem bg-red-500 text-white px-2 py-1 rounded">Remove</button></div>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
        <input placeholder="Product Link URL" class="productLink border rounded p-2 col-span-2 md:col-span-3"/>
        <input placeholder="Product Name" class="productName border rounded p-2 col-span-2 md:col-span-3"/>
        <input placeholder="Brand" class="productBrand border rounded p-2"/>
        <input placeholder="Image URL" class="productImage border rounded p-2 col-span-2"/>
        <input placeholder="MSRP" class="productMsrp border rounded p-2"/>
        <input placeholder="Price" class="productPrice border rounded p-2"/>
        <input placeholder="Rating" type="number" step="0.5" min="0" max="5" class="productRating border rounded p-2"/>
        <input placeholder="Reviews" type="number" class="productReviews border rounded p-2"/>
        <label class="text-sm font-medium col-span-2 md:col-span-3">Promo Badge (optional)</label>
        <select class="productBadge border rounded p-2 col-span-2 md:col-span-3"><option value="">None</option><option value="clearance">Clearance</option><option value="last-chance">Last Chance</option><option value="new">New</option><option value="exclusive">NEX Exclusive</option></select>
      </div>
    </div>
  </template>

<script>
$(function(){var BASE='https://www.mynavyexchange.com';var MAX=10;var placeholder='<div class="placeholder">No Image Added</div>';
function full(u){return u&&u[0]==='/'?BASE+u:u;}
function charStars(r){var v=parseFloat(r)||0;var f=Math.floor(v),h=v%1>=0.5,html='';for(var i=0;i<f;i++){html+='<span class="star">★</span>';}if(h)html+='<span class="star">☆</span>';return html;}
function gifStars(r){var v=parseFloat(r)||0;var rnd=Math.round(v*2)/2;var f=String(rnd).replace('.','_');return '<img alt="Product Rating '+f+'" class="ratingsStars" src="/ux/img/stars/rating-'+f+'.gif">';}
function badge(t){if(!t)return'';var m={clearance:'Clearance','last-chance':'Last Chance',new:'New',exclusive:'NEX Exclusive'};return '<span class="promo-badge" data-type="'+t+'">'+m[t]+'</span>';}
function updateCounts(){var c=$('#itemsContainer [data-item]').length;$('#addItem').text('Add Item ('+c+'/'+MAX+')').prop('disabled',c>=MAX).toggleClass('opacity-50 cursor-not-allowed',c>=MAX);$('#itemsContainer [data-item]').each(function(i){$(this).find('.itemIndex').text(i+1);});}
function toggleFields(){var tpl=$('#templateSelect').val();$('#itemsContainer [data-item]').each(function(){var $e=$(this);$e.find('.productBrand').parent().toggle(tpl==='standard');$e.find('.productMsrp').parent().toggle(tpl==='standard');$e.find('.productPrice').parent().toggle(tpl!=='minimal');$e.find('.productBadge').parent().toggle(tpl==='promo');});}
function addItem(d){if($('#itemsContainer [data-item]').length>=MAX)return;d=d||{};var node=document.getElementById('itemTemplate').content.cloneNode(true);$('#itemsContainer').append(node);var $w=$('#itemsContainer [data-item]').last();for(var k in d){$w.find('.product'+k.charAt(0).toUpperCase()+k.slice(1)).val(d[k]);}updateCounts();toggleFields();refresh();}
$('#templateSelect').on('change',function(){toggleFields();refresh();});
$('#addItem').on('click',function(){addItem();});
$('#itemsContainer').on('click','.removeItem',function(){$(this).closest('[data-item]').remove();updateCounts();refresh();});
$('#builder').on('input change','input,select',refresh);
$('#csvFile').on('change',function(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(evt){var rows=evt.target.result.split(/\r?\n/).filter(function(x){return x.trim();});var head=rows.shift().split(',');$('#itemsContainer').empty();rows.forEach(function(line){var vals=line.split(',');var obj={};head.forEach(function(h,i){obj[h.trim()]=vals[i]||'';});addItem(obj);});};r.readAsText(f);});
$('#importBtn').on('click',function(){var raw=$('#importHtml').val();if(!raw.trim()){alert('Paste snippet first');return;}var safe=raw.split(/<script/i)[0];var doc=new DOMParser().parseFromString(safe,'text/html');var ttl=doc.querySelector('.sg-content-item .bold');if(ttl)$('#carouselTitle').val(ttl.textContent.trim());var cards=doc.querySelectorAll('.product-card_content');if(!cards.length){alert('Could not find product cards');return;}$('#itemsContainer').empty();cards.forEach(function(c){var altEl=c.querySelector('.ratingsStars'),alt=altEl?altEl.getAttribute('alt'):'';var m=alt.match(/([0-5](?:_[05])?)/);addItem({link:(c.querySelector('a')||{}).getAttribute?c.querySelector('a').getAttribute('href'):'' ,image:(c.querySelector('img')||{}).getAttribute?c.querySelector('img').getAttribute('src'):'' ,brand:(c.querySelector('.product-card_brand')||{}).textContent?c.querySelector('.product-card_brand').textContent.trim():'' ,name:(c.querySelector('.product-card_name')||{}).textContent?c.querySelector('.product-card_name').textContent.trim():'' ,msrp:(c.querySelector('.product-card_price_msrp_strike')||{}).textContent?c.querySelector('.product-card_price_msrp_strike').textContent.trim():'' ,price:(c.querySelector('.product-card_price_regular span')||{}).textContent?c.querySelector('.product-card_price_regular span').textContent.trim():'' ,reviews:(function(){var s=c.querySelector('.product-card_reviews span');var tx=s?s.textContent:'';var n=tx.match(/\d+/);return n?n[0]:'';}()) ,rating:m?m[1].replace('_','.'):'',badge:(c.querySelector('.promo-badge')||{}).dataset?c.querySelector('.promo-badge').dataset.type:'' });});toggleFields();refresh();});
function previewCard(d,i,tpl,show){var img=d.image?'<img src="'+full(d.image)+'" alt="'+(d.name||'product')+'">':placeholder;var name=d.name?'<div class="product-card_name">'+d.name+'</div>':'';var brand=d.brand?'<p class="product-card_brand font-semibold"><a href="'+full(d.link)+'">'+d.brand+'</a></p>':'';var msrp=d.msrp?'<div class="product-card_price_msrp">Retail Price: <span class="product-card_price_msrp_strike"> '+d.msrp+' </span></div>':'';var price=d.price?'<div class="product-card_price_regular">NEX Price <span> '+d.price+' </span></div>':'';var body='';if(tpl==='minimal')body=name;else if(tpl==='promo')body=name+price;else body=brand+name+msrp+price;var rev=show?'<div class="product-card_reviews mt-2 mb-2 d-flex align-items-center">'+charStars(d.rating)+' <span class="ml-2">('+d.reviews+')</span></div>':'';return '<div class="relative w-48" data-idx="'+i+'"><div class="badge">'+(i+1)+'</div>'+badge(d.badge)+'<a href="'+full(d.link)+'">'+img+'</a><div class="text-sm mt-2">'+body+rev+'</div></div>';}
function exportHTML(arr,tpl,show){var inner=arr.map(function(d,i){var img=d.image?'<img src="'+d.image+'" alt="'+(d.name||'product')+'">':placeholder;var name=d.name?'<div class="product-card_name">'+d.name+'</div>':'';var brand=d.brand?'<p class="product-card_brand"><a href="'+d.link+'">'+d.brand+'</a></p>':'';var msrp=d.msrp?'<div class="product-card_price_msrp">Retail Price: <span class="product-card_price_msrp_strike"> '+d.msrp+' </span></div>':'';var price=d.price?'<div class="product-card_price_regular">NEX Price <span> '+d.price+' </span></div>':'';var body='';if(tpl==='minimal')body=name;else if(tpl==='promo')body=name+price;else body=brand+name+msrp+price;var rev=show?'<div class="product-card_reviews mt-2 mb-2 d-flex align-items-center">'+gifStars(d.rating)+' <span class="ml-2">('+d.reviews
