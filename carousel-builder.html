<script>
$(function () {
  var BASE='https://www.mynavyexchange.com',
      MAX =10,
      placeholder='<div class="placeholder">No Image Added</div>';

  function full(u){return u&&u[0]==='/'?BASE+u:u;}
  function badge(t){if(!t)return'';var m={clearance:'Clearance','last-chance':'Last Chance',new:'New',exclusive:'NEX Exclusive'};return'<span class="promo-badge" data-type="'+t+'">'+m[t]+'</span>'; }
  function charStars(r){var v=parseFloat(r)||0,f=Math.floor(v),h=v%1>=.5,s='';while(f--)s+='<span class="star">★</span>';if(h)s+='<span class="star">☆</span>';return s;}
  function gifStars(r){var v=parseFloat(r)||0,f=String(Math.round(v*2)/2).replace('.','_');return'<img alt="Product Rating '+f+'" class="ratingsStars" src="/ux/img/stars/rating-'+f+'.gif">';}

  function showHide(){
    var t=$('#templateSelect').val();
    $('#itemsContainer [data-item]').each(function(){
      var $e=$(this);
      $e.find('.productBrand').parent().toggle(t==='standard');
      $e.find('.productMsrp' ).parent().toggle(t==='standard');
      $e.find('.productPrice').parent().toggle(t!=='minimal');
      $e.find('.productBadge').parent().toggle(t==='promo');
    });
  }

  function updateCounts(){
    var c=$('#itemsContainer [data-item]').length;
    $('#addItem').text('Add Item ('+c+'/'+MAX+')')
                 .prop('disabled',c>=MAX)
                 .toggleClass('opacity-50 cursor-not-allowed',c>=MAX);
    $('#itemsContainer [data-item]').each(function(i){
      $(this).find('.itemIndex').text(i+1);
    });
  }

  function addItem(data){
    if($('#itemsContainer [data-item]').length>=MAX)return;
    data = data || {};

    var html = document.getElementById('itemTemplate').innerHTML.trim();
    $('#itemsContainer').append(html);

    var $w = $('#itemsContainer [data-item]').last();
    for(var k in data){
      $w.find('.product'+k.charAt(0).toUpperCase()+k.slice(1)).val(data[k]);
    }
    updateCounts();
    showHide();
    refresh();
  }

  $('#templateSelect').on('change',function(){showHide();refresh();});
  $('#addItem').on('click',function(){addItem();});
  $('#itemsContainer').on('click','.removeItem',function(){$(this).closest('[data-item]').remove();updateCounts();refresh();});
  $('#builder').on('input change','input,select',refresh);

  /* CSV upload, Import, preview, export and Sortable code unchanged */

  addItem();
  showHide();
});
</script>
