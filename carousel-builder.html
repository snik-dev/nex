<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MNE.com Carousel Generator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{navy:'#002366',gold:'#ffc72c'}}}};</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
.badge{position:absolute;top:6px;left:6px;background:#ffc72c;color:#002366;font-weight:700;font-size:.75rem;padding:2px 6px;border-radius:9999px}
.promo-badge{position:absolute;top:6px;right:6px;background:#002366;color:#fff;font-size:.625rem;font-weight:700;padding:2px 6px;border-radius:4px}
.placeholder{background:#e2e8f0;display:flex;align-items:center;justify-content:center;height:200px;font-size:.875rem;color:#6b7280}
</style>
</head>
<body class="bg-gray-100 p-6 flex flex-col gap-6">

<header class="bg-navy text-white p-4 rounded shadow mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
  <h1 class="text-2xl font-semibold">MNE.com Carousel Generator</h1>
  <div class="flex items-center gap-2">
    <input id="csvFile" type="file" accept=".csv" class="text-xs bg-white text-navy rounded p-1">
    <a href="https://snik-dev.github.io/nex/template.csv" target="_blank" class="underline text-xs">Download CSV template</a>
  </div>
</header>

<div class="grid lg:grid-cols-3 gap-6 w-full">
  <div class="lg:col-span-1 space-y-6">
    <form id="builder" class="space-y-4">
      <div><label class="block font-medium mb-1">Carousel Title</label><input id="carouselTitle" class="border rounded p-2 w-full"></div>
      <div id="itemsContainer" class="space-y-6"></div>
      <button id="addItem" type="button" class="bg-gold text-navy w-full py-2 rounded shadow">Add Item (0/10)</button>
    </form>
  </div>

  <div class="lg:col-span-2">
    <h2 class="text-xl font-semibold mb-2">Live Preview <span class="text-sm text-gray-600">(drag to reorder)</span></h2>
    <div id="previewTitle" class="font-semibold text-lg mb-3"></div>
    <div id="previewArea" class="flex flex-nowrap gap-4 overflow-x-auto pb-4 min-h-[200px]"></div>
  </div>
</div>

<div class="grid lg:grid-cols-2 gap-6 mt-8">
  <div>
    <h2 class="text-xl font-semibold mb-2">Generated HTML</h2>
    <textarea id="output" class="w-full h-64 border p-2 font-mono text-xs"></textarea>
    <button id="copyCode" class="mt-2 px-4 py-2 bg-navy text-white rounded shadow">Copy</button>
  </div>
  <div>
    <h2 class="text-xl font-semibold mb-2">HTML Input (Import)</h2>
    <textarea id="importHtml" class="w-full h-64 border p-2 font-mono text-xs"></textarea>
    <button id="importBtn" class="mt-2 px-4 py-2 bg-navy text-white rounded shadow">Import</button>
  </div>
</div>

<script>
$(function(){
  var BASE='https://www.mynavyexchange.com',MAX=10,ph='<div class="placeholder">No Image Added</div>';
  var mapBadge={clearance:'Clearance','last-chance':'Last Chance',new:'New',exclusive:'NEX Exclusive'};

  function rel(u){return u.replace(/^https?:\\/\\/www\\.mynavyexchange\\.com/,'');}
  function full(u){return u&&u[0]==='/'?BASE+u:u;}
  function badge(t){return t?'<span class="promo-badge">'+mapBadge[t]+'</span>':'';}
  function stars(v){v=parseFloat(v)||0;var s='';for(var i=1;i<=5;i++){if(v>=i)s+='★';else if(v>=i-0.5)s+='½';else s+='☆';}return s;}

  function rowHTML(i){
    return '<div data-item class="border p-4 bg-white rounded shadow space-y-2">'+
      '<div class="flex justify-between items-center mb-2">'+
        '<span class="itemIndex font-bold">Product '+i+'</span>'+
        '<button type="button" class="removeItem bg-red-500 text-white px-2 py-1 rounded">Remove</button></div>'+
      field('link','Product Link URL','url','Paste full URL – saved relative')+
      field('image','Image URL','url')+
      field('brand','Brand')+
      field('name','Name')+
      field('msrp','MSRP')+
      field('price','Price')+
      field('rating','Rating 0-5','.5','number step="0.5" min="0" max="5"')+
      field('reviews','Review Count','number')+
      fieldSelect()+'</div>';
  }

  function field(key,label,type,placeholder,extra){
    placeholder=placeholder||'';extra=extra||'';
    return '<label class="flex items-center gap-2"><input type="checkbox" class="toggleField" data-f="'+key+'" checked>'+label+'</label>'+
           '<input '+(extra||'type="'+(type||'text')+'"')+' class="product'+cap(key)+' border rounded p-2 w-full" placeholder="'+placeholder+'">';
  }
  function fieldSelect(){
    return '<label class="flex items-center gap-2"><input type="checkbox" class="toggleField" data-f="badge" checked>Promo Badge</label>'+
           '<select class="productBadge border rounded p-2 w-full"><option value="">None</option><option value="clearance">Clearance</option><option value="last-chance">Last Chance</option><option value="new">New</option><option value="exclusive">NEX Exclusive</option></select>';
  }
  function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}

  function addRow(){
    var c=$('#itemsContainer [data-item]').length;if(c>=MAX)return;
    $('#itemsContainer').append(rowHTML(c+1));
    $('#addItem').text('Add Item ('+(c+1)+'/'+MAX+')');
    refresh();
  }

  $('#addItem').on('click',addRow);
  $('#itemsContainer').on('click','.removeItem',function(){
    $(this).closest('[data-item]').remove();
    $('#itemsContainer [data-item]').each(function(i){$(this).find('.itemIndex').text('Product '+(i+1));});
    $('#addItem').text('Add Item ('+$('#itemsContainer [data-item]').length+'/'+MAX+')');
    refresh();
  });
  $('#builder').on('input change','input,select',refresh);
  $('#itemsContainer').on('change','.toggleField',refresh);

  function collect(){
    var out=[];
    $('#itemsContainer [data-item]').each(function(){
      var $e=$(this),sh={};$e.find('.toggleField').each(function(){sh[$(this).data('f')]=$(this).is(':checked');});
      out.push({show:sh,link:rel($e.find('.productLink').val()),image:$e.find('.productImage').val(),brand:$e.find('.productBrand').val(),name:$e.find('.productName').val(),msrp:$e.find('.productMsrp').val(),price:$e.find('.productPrice').val(),rating:$e.find('.productRating').val(),reviews:$e.find('.productReviews').val(),badge:$e.find('.productBadge').val()});
    });
    return out;
  }

  function card(d,i){
    var img=d.show.image&&d.image?'<img src="'+full(d.image)+'" alt="">':ph,seg='';
    if(d.show.brand&&d.brand)seg+='<p class="font-semibold">'+d.brand+'</p>';
    if(d.show.name&&d.name)seg+='<div>'+d.name+'</div>';
    if(d.show.msrp&&d.msrp)seg+='<div>Retail: '+d.msrp+'</div>';
    if(d.show.price&&d.price)seg+='<div>NEX: '+d.price+'</div>';
    if(d.show.reviews)seg+='<div>'+stars(d.rating)+' ('+d.reviews+')</div>';
    return '<div class="relative w-44">'+badge(d.show.badge?d.badge:'')+'<div class="badge">'+(i+1)+'</div><a href="'+full(d.link)+'">'+img+'</a><div class="text-sm mt-2">'+seg+'</div></div>';
  }

  function refresh(){
    $('#previewTitle').text($('#carouselTitle').val());
    var data=collect();
    $('#previewArea').html(data.map(card).join(''));
    $('#output').val(JSON.stringify(data,null,2));
  }

  new Sortable(document.getElementById('previewArea'),{animation:150,onEnd:function(evt){
    var p=$('#itemsContainer [data-item]').eq(evt.oldIndex).detach();
    if(evt.newIndex===0)$('#itemsContainer').prepend(p);else $('#itemsContainer [data-item]').eq(evt.newIndex).before(p);
    $('#itemsContainer [data-item]').each(function(i){$(this).find('.itemIndex').text('Product '+(i+1));});
    refresh();
  }});

  $(document).on('click','#copyCode',function(){navigator.clipboard.writeText($('#output').val());});

  addRow();
});
</script>
</body>
</html>
