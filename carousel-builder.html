<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MNE.com Carousel Generator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{navy:'#002366',gold:'#ffc72c'}}}};</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</head>
<body class="bg-gray-100 h-screen flex flex-col">

<header class="bg-navy text-white p-4 flex flex-wrap gap-4 items-center justify-between">
  <h1 class="text-xl font-semibold whitespace-nowrap">MNE.com Carousel Generator</h1>
  <div class="flex gap-2 items-center">
    <input id="csvFile" type="file" accept=".csv" class="text-xs bg-white text-navy rounded p-1">
    <a href="https://snik-dev.github.io/nex/template.csv" class="underline text-xs">Download CSV template</a>
  </div>
</header>

<main class="flex-1 grid lg:grid-cols-[2fr_1fr] gap-4 p-4 overflow-hidden">
  <section class="flex flex-col overflow-hidden">
    <div class="flex gap-4 mb-4 items-end">
      <div class="flex-1"><label class="block font-medium text-sm">Carousel Title</label><input id="carouselTitle" class="w-full border rounded p-2"></div>
      <button id="addRow" class="bg-gold text-navy px-4 py-2 rounded shadow whitespace-nowrap">Add Product (0/10)</button>
    </div>

    <div class="flex gap-4 mb-2 flex-wrap">
      <label class="flex items-center gap-1 text-sm"><input type="checkbox" class="fieldToggle" value="brand" checked>Brand</label>
      <label class="flex items-center gap-1 text-sm"><input type="checkbox" class="fieldToggle" value="msrp" checked>MSRP</label>
      <label class="flex items-center gap-1 text-sm"><input type="checkbox" class="fieldToggle" value="price" checked>Price</label>
      <label class="flex items-center gap-1 text-sm"><input type="checkbox" class="fieldToggle" value="reviews" checked>Reviews</label>
      <label class="flex items-center gap-1 text-sm"><input type="checkbox" class="fieldToggle" value="badge" checked>Badge</label>
    </div>

    <div class="overflow-auto flex-1">
      <table class="min-w-full text-sm whitespace-nowrap">
        <thead class="bg-gray-200 sticky top-0">
          <tr>
            <th class="w-8">#</th>
            <th>Image</th>
            <th data-col="name">Name</th>
            <th data-col="brand">Brand</th>
            <th data-col="msrp">MSRP</th>
            <th data-col="price">Price</th>
            <th data-col="badge">Badge</th>
            <th class="w-8"></th>
          </tr>
        </thead>
        <tbody id="gridBody"></tbody>
      </table>
    </div>
  </section>

  <aside class="flex flex-col gap-2">
    <h2 class="font-semibold">Live Preview</h2>
    <div id="preview" class="flex flex-col gap-4 overflow-auto border p-2 bg-white rounded flex-1"></div>
  </aside>
</main>

<section class="border-t p-4">
  <details>
    <summary class="cursor-pointer font-medium">Generated HTML / Import</summary>
    <div class="grid lg:grid-cols-2 gap-4 mt-4">
      <div>
        <textarea id="out" class="w-full h-48 border p-2 text-xs font-mono"></textarea>
        <button id="copy" class="mt-1 bg-navy text-white px-3 py-1 rounded text-sm">Copy</button>
      </div>
      <div>
        <textarea id="in" class="w-full h-48 border p-2 text-xs font-mono"></textarea>
        <button id="import" class="mt-1 bg-navy text-white px-3 py-1 rounded text-sm">Import</button>
      </div>
    </div>
  </details>
</section>

<template id="rowTemplate">
  <tr data-row>
    <td class="index text-center"></td>
    <td><input type="url" data-f="image" class="w-32 border rounded p-1"></td>
    <td data-col="name"><input type="text" data-f="name" class="border rounded p-1 w-40"></td>
    <td data-col="brand"><input type="text" data-f="brand" class="border rounded p-1 w-32"></td>
    <td data-col="msrp"><input type="text" data-f="msrp" class="border rounded p-1 w-20"></td>
    <td data-col="price"><input type="text" data-f="price" class="border rounded p-1 w-20"></td>
    <td data-col="badge">
      <select data-f="badge" class="border rounded p-1">
        <option value="">—</option><option value="clearance">Clearance</option><option value="last-chance">Last Chance</option><option value="new">New</option><option value="exclusive">NEX Exclusive</option>
      </select>
    </td>
    <td><button class="del text-red-600">✕</button></td>
  </tr>
</template>

<script>
const MAX=10,badgeMap={clearance:'Clearance','last-chance':'Last Chance',new:'New',exclusive:'NEX Exclusive'};
const tmpl=document.getElementById('rowTemplate').content,body=document.getElementById('gridBody'),preview=document.getElementById('preview'),out=document.getElementById('out');
const urlRel=u=>u.replace(/^https?:\/\/www\.mynavyexchange\.com/,'');const urlFull=u=>u&&u[0]==='/'?'https://www.mynavyexchange.com'+u:u;
const stars=v=>{v=parseFloat(v)||0;let s='';for(let i=1;i<=5;i++)s+=v>=i?'★':v>=i-.5?'½':'☆';return s};
function renumber(){[...body.children].forEach((r,i)=>r.querySelector('.index').textContent=i+1);document.getElementById('addRow').textContent=`Add Product (${body.children.length}/${MAX})`}
function rowData(tr){let d={};tr.querySelectorAll('[data-f]').forEach(i=>d[i.dataset.f]=i.type==='url'?urlRel(i.value):i.value);return d}
function buildPrev(d,i){return `<div class="relative text-xs w-40"><div class="badge">${i+1}</div>${d.badge?`<span class="promo-badge">${badgeMap[d.badge]}</span>`:''}<a href="${urlFull(d.link||'')}"><img src="${urlFull(d.image||'')}" class="w-full h-28 object-cover bg-gray-200" onerror="this.src=''"></a><div class="mt-1">${d.brand?`<p class="font-semibold">${d.brand}</p>`:''}${d.name?`<p>${d.name}</p>`:''}${d.msrp?`<p>Retail: ${d.msrp}</p>`:''}${d.price?`<p>NEX: ${d.price}</p>`:''}${d.reviews?`<p>${stars(d.rating)} (${d.reviews})</p>`:''}</div></div>`}
function refresh(){const rows=[...body.children].map(rowData);preview.innerHTML=rows.map(buildPrev).join('');out.value=JSON.stringify(rows,null,2)}
document.getElementById('addRow').onclick=()=>{if(body.children.length<MAX){body.append(tmpl.cloneNode(true));renumber();refresh()}};
body.addEventListener('input',refresh);
body.addEventListener('click',e=>{if(e.target.classList.contains('del')){e.target.closest('tr').remove();renumber();refresh()}});
document.querySelectorAll('.fieldToggle').forEach(c=>{c.onchange=()=>{document.querySelectorAll(`[data-col="${c.value}"]`).forEach(td=>td.classList.toggle('hidden',!c.checked));refresh()}});
new Sortable(preview,{animation:150,onEnd:e=>{body.append(body.children[e.oldIndex]);}})
renumber();refresh();
</script>
</body>
</html>
