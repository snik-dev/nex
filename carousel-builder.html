<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MNE.com Carousel Builder</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{navy:'#002366',gold:'#ffc72c'}}}};</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
.badge{position:absolute;top:6px;left:6px;background:#ffc72c;color:#002366;font-size:.75rem;font-weight:700;padding:2px 6px;border-radius:9999px}
.promo-badge{position:absolute;top:6px;right:6px;background:#002366;color:#fff;font-size:.625rem;font-weight:700;padding:2px 6px;border-radius:4px}
.placeholder{background:#e2e8f0;display:flex;align-items:center;justify-content:center;height:180px;font-size:.875rem;color:#6b7280}
</style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

<header class="bg-navy text-white p-4 flex flex-wrap items-center gap-4 justify-between">
  <h1 class="text-lg font-semibold whitespace-nowrap">MNE.com Carousel Generator</h1>
  <label class="text-xs flex items-center gap-2 whitespace-nowrap">
    Bulk CSV Upload
    <input id="csv" type="file" accept=".csv" class="bg-white text-navy rounded p-1">
    <a href="https://snik-dev.github.io/nex/template.csv" target="_blank" class="underline">template</a>
  </label>
</header>

<main class="p-4 flex-1 flex flex-col gap-6 overflow-auto">

  <section class="space-y-4">

    <label class="block text-sm font-medium">Carousel Title (optional)
      <input id="title" class="mt-1 border rounded p-2 w-full">
    </label>

    <div class="flex gap-4 flex-wrap text-sm">
      <label class="flex items-center gap-1"><input type="checkbox" class="toggle" value="brand" checked>Brand</label>
      <label class="flex items-center gap-1"><input type="checkbox" class="toggle" value="msrp" checked>MSRP</label>
      <label class="flex items-center gap-1"><input type="checkbox" class="toggle" value="price" checked>Price</label>
      <label class="flex items-center gap-1"><input type="checkbox" class="toggle" value="reviews" checked>Reviews</label>
      <label class="flex items-center gap-1"><input type="checkbox" class="toggle" value="badge" checked>Badge</label>
    </div>

    <div id="cards" class="space-y-4"></div>
    <button id="add" class="bg-gold text-navy w-full py-2 rounded shadow">Add Product (0/10)</button>
  </section>

  <section class="border rounded p-3 bg-white">
    <h2 class="font-semibold mb-2">Live Preview <span class="text-xs text-gray-600">(drag to reorder)</span></h2>
    <div id="preview" class="flex gap-4 overflow-x-auto"></div>
  </section>

  <section class="grid lg:grid-cols-2 gap-4">
    <div>
      <h2 class="font-semibold mb-1 text-sm">Generated HTML</h2>
      <textarea id="export" class="w-full h-48 border p-2 text-xs font-mono"></textarea>
      <button id="copy" class="mt-1 bg-navy text-white px-3 py-1 rounded text-xs">Copy</button>
    </div>
    <div>
      <h2 class="font-semibold mb-1 text-sm">Paste HTML to Import</h2>
      <textarea id="importArea" class="w-full h-48 border p-2 text-xs font-mono"></textarea>
      <button id="importBtn" class="mt-1 bg-navy text-white px-3 py-1 rounded text-xs">Import</button>
    </div>
  </section>

</main>

<template id="cardTpl">
<details open data-card class="border bg-white rounded shadow">
  <summary class="cursor-pointer select-none flex justify-between items-center p-3">
    <span class="font-semibold text-sm cardHead">Product #</span>
    <button class="remove text-red-600 text-xs">✕</button>
  </summary>
  <div class="p-3 grid md:grid-cols-2 gap-3">
    <input data-f="link" placeholder="Product URL (relative ok)" class="border rounded p-2 col-span-2">
    <input data-f="image" placeholder="Image URL" class="border rounded p-2 col-span-2">
    <input data-f="name"  placeholder="Name"  class="border rounded p-2">
    <input data-f="brand" placeholder="Brand" class="border rounded p-2 field-brand">
    <input data-f="msrp"  placeholder="MSRP"  class="border rounded p-2 field-msrp">
    <input data-f="price" placeholder="Price" class="border rounded p-2 field-price">
    <input data-f="rating" type="number" step="0.5" min="0" max="5" placeholder="Rating" class="border rounded p-2 field-reviews">
    <input data-f="reviews" type="number" placeholder="Review count" class="border rounded p-2 field-reviews">
    <select data-f="badge" class="border rounded p-2 field-badge">
      <option value="">No Badge</option><option value="clearance">Clearance</option><option value="last-chance">Last Chance</option><option value="new">New</option><option value="exclusive">NEX Exclusive</option>
    </select>
  </div>
</details>
</template>

<script>
const MAX=10,badgeTxt={clearance:'Clearance','last-chance':'Last Chance',new:'New',exclusive:'NEX Exclusive'},
base='https://www.mynavyexchange.com',cards=$("#cards"),tpl=$("#cardTpl").html(),
preview=$("#preview"),exp=$("#export");

const rel=u=>u.replace(/^https?:\/\/www\.mynavyexchange\.com/,''),
full=u=>u&&u[0]==='/'?base+u:u,
ascii=v=>{v=parseFloat(v)||0;let s='';for(let i=1;i<=5;i++)s+=v>=i?'★':v>=i-.5?'½':'☆';return s};

function addCard(o={}){
  if(cards.children().length>=MAX)return;
  const el=$(tpl).appendTo(cards);
  Object.entries(o).forEach(([k,v])=>el.find(`[data-f=${k}]`).val(v));
  cards.children('details').not(el).prop('open',false);
  renumber();build();
}
function renumber(){cards.children().each((i,e)=>$(e).find('.cardHead').text('Product '+(i+1)));$('#add').text(`Add Product (${cards.children().length}/${MAX})`)}
function gather(){return cards.children().map((_,d)=>{const o={};$(d).find('[data-f]').each((__,f)=>o[$(f).data('f')]=$(f).val());o.link=rel(o.link||'');return o}).get();}
function badge(b){return b?`<span class="promo-badge">${badgeTxt[b]}</span>`:''}

function previewHtml(d,i){
  return `<div class="relative w-48 shrink-0">
    <span class="badge">${i+1}</span>${badge(d.badge)}
    <a href="${full(d.link)}">${d.image?`<img src="${full(d.image)}" class="w-full h-28 object-cover bg-gray-200">`:'<div class="placeholder">No Image</div>'}</a>
    <div class="text-xs mt-1">
      ${d.brand?`<p class="font-semibold">${d.brand}</p>`:''}
      ${d.name?`<p>${d.name}</p>`:''}
      ${d.msrp?`<p>Retail Price: ${d.msrp}</p>`:''}
      ${d.price?`<p>NEX Price ${d.price}</p>`:''}
      ${d.reviews?`<p>${ascii(d.rating)} (${d.reviews})</p>`:''}
    </div></div>`;
}

function exportHtml(d,i){
  const file=(d.rating?String(d.rating).replace('.','_'):'0_0');
  return `<div class="product-card_content product-card_slider relative">
    <span class="badge">${i+1}</span>${badge(d.badge)}
    <div class="product-card_content_images p-0 mb-3"><a href="${d.link}"><img src="${d.image}" /></a></div>
    <div class="product-card_content_description">
      ${d.brand?`<p class="product-card_brand"><a href="${d.link}">${d.brand}</a></p>`:''}
      ${d.name?`<div class="product-card_name">${d.name}</div>`:''}
      ${d.msrp?`<div class="product-card_price_msrp">Retail Price: <span class="product-card_price_msrp_strike"> ${d.msrp} </span></div>`:''}
      ${d.price?`<div class="product-card_price_regular">NEX Price <span> ${d.price} </span></div>`:''}
      ${d.reviews?`<div class="product-card_reviews mt-1"><img alt="Product Rating" class="ratingsStars" src="/ux/img/stars/rating-${file}.gif" /> <span> (${d.reviews}) </span></div>`:''}
    </div></div>`;
}

function build(){
  const list=gather();
  preview.html(list.map(previewHtml).join(''));
  exp.val('<div class="owl-carousel recently-viewed-carousel owl-theme">'+list.map(exportHtml).join('')+'</div>');
}

$('#add').on('click',()=>addCard());
cards.on('click','.remove',e=>{$(e.target).closest('details').remove();renumber();build()});
cards.on('input','input,select',build);
$('.toggle').on('change',function(){$(`.field-${this.value}`).toggle(this.checked);build()});
new Sortable(preview[0],{animation:150,onEnd:e=>{const c=cards.children().eq(e.oldIndex).detach();e.newIndex===0?cards.prepend(c):cards.children().eq(e.newIndex).before(c);renumber();build();}});

$("#importBtn").on("click",function(){
  const raw=$("#importArea").val().trim();if(!raw)return;
  const $tmp=$("<div>").html(raw),$blocks=$tmp.find(".product-card_content");
  if(!$blocks.length)return alert("No product-card_content blocks found.");
  cards.empty();
  $blocks.each(function(){
    const $c=$(this); const gif=$c.find(".ratingsStars").attr("src")||"";
    addCard({
      link:$c.find("a").attr("href")||"",
      image:$c.find("img").attr("src")||"",
      brand:$c.find(".product-card_brand").text().trim(),
      name:$c.find(".product-card_name").text().trim(),
      msrp:$c.find(".product-card_price_msrp_strike").text().trim(),
      price:$c.find(".product-card_price_regular span").text().trim(),
      badge:($c.find(".promo-badge").text().trim()||"").toLowerCase().replace(" ","-"),
      reviews:($c.find(".product-card_reviews span").text().match(/\d+/)||[""])[0],
      rating:(gif.match(/rating-(\d_\d|\d_0)/)||["",""])[1].replace("_",".")
    });
  });
  renumber();build();
});

addCard();
build();
</script>
</body>
</html>
